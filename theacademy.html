<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Academy - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù…Ù†Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #0095f6;
            --secondary-color: #8e8e8e;
            --bg-color: #fafafa;
            --card-bg: #ffffff;
            --border-color: #dbdbdb;
            --text-color: #262626;
            --premium-color: #ffd700;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); padding-bottom: 60px; }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--card-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .login-container { width: 100%; max-width: 350px; text-align: center; }
        .logo-large { font-size: 40px; font-weight: 700; margin-bottom: 20px; background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-form { background: var(--card-bg); border: 1px solid var(--border-color); padding: 20px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .login-input { width: 100%; padding: 10px; margin-bottom: 10px; background: #fafafa; border: 1px solid var(--border-color); border-radius: 3px; font-size: 14px; }
        .login-btn { width: 100%; padding: 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; margin-bottom: 15px; }
        .separator { display: flex; align-items: center; margin: 15px 0; color: var(--secondary-color); font-size: 13px; }
        .separator::before, .separator::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
        .separator::before { margin-left: 10px; }
        .separator::after { margin-right: 10px; }
        .signup-link { color: var(--primary-color); font-weight: 600; text-decoration: none; font-size: 14px; }
        .app-content { display: none; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { position: fixed; top: 0; left: 0; right: 0; height: 60px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 1000; }
        .logo { font-size: 22px; font-weight: 700; background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: absolute; right: 50%; transform: translateX(50%); }
        .header-icons, .header-profile { display: flex; align-items: center; gap: 15px; }
        .header-icon { font-size: 20px; cursor: pointer; }
        .header-profile-icon img { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 1px solid var(--border-color); }

        /* Ø§Ù„Ø³ØªÙˆØ±ÙŠ */
        .stories-container { margin-top: 60px; padding: 15px 0; background: var(--card-bg); border-bottom: 1px solid var(--border-color); overflow-x: auto; white-space: nowrap; }
        .stories { display: flex; padding: 0 15px; gap: 15px; }
        .story { display: flex; flex-direction: column; align-items: center; width: 70px; cursor: pointer; position: relative; }
        .story-avatar { width: 60px; height: 60px; border-radius: 50%; padding: 2px; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); display: flex; align-items: center; justify-content: center; }
        .story-avatar.premium-story { background: linear-gradient(45deg, #ffd700, #f7b733, #f5a623, #ffc400); border: 2px solid var(--premium-color); }
        .story-avatar img { width: 56px; height: 56px; border-radius: 50%; border: 2px solid white; object-fit: cover; }
        .story-avatar-add { width: 60px; height: 60px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; border: 2px dashed var(--secondary-color); }
        .story-avatar-add i { color: var(--secondary-color); font-size: 20px; }
        .story-text { font-size: 12px; margin-top: 5px; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; background: rgba(0,0,0,0.5); color: white; padding: 2px 5px; border-radius: 5px; position: absolute; bottom: 5px; }
        .story-username { font-size: 12px; margin-top: 5px; }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .feed-tabs { display: flex; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .feed-tab { flex: 1; text-align: center; padding: 15px; font-weight: 600; cursor: pointer; border-bottom: 2px solid transparent; }
        .feed-tab.active { border-bottom-color: var(--text-color); }

        /* Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª */
        .feed { padding-bottom: 60px; }
        .post { background: var(--card-bg); margin: 15px; border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .post-header { display: flex; align-items: center; justify-content: space-between; padding: 15px; }
        .post-user { display: flex; align-items: center; gap: 10px; }
        .post-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .post-user-info { display: flex; flex-direction: column; }
        .post-username { font-weight: 600; font-size: 14px; }
        .post-user-type { font-size: 11px; color: var(--secondary-color); }
        .premium-badge { background: var(--premium-color); color: #000; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: bold; margin-right: 5px; }
        .post-more { cursor: pointer; }
        .post-media { width: 100%; max-height: 500px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .post-media img, .post-media video, .post-media iframe { width: 100%; height: 100%; object-fit: cover; border: none; }
        .post-media iframe { min-height: 315px; object-fit: contain; }
        .post-image { width: 100%; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: var(--secondary-color); }
        .post-actions { padding: 10px 15px; display: flex; justify-content: space-between; }
        .post-actions-left { display: flex; gap: 15px; }
        .post-action { font-size: 24px; cursor: pointer; transition: transform 0.2s; }
        .post-action:hover { transform: scale(1.1); }
        .post-action.liked { color: var(--danger-color); }
        .post-likes { padding: 0 15px; font-weight: 600; font-size: 14px; margin-bottom: 5px; }
        .post-caption { padding: 0 15px; font-size: 14px; margin-bottom: 5px; white-space: pre-wrap; }
        .post-caption .username { font-weight: 600; margin-left: 5px; }
        .post-comments { padding: 0 15px; color: var(--secondary-color); font-size: 14px; margin-bottom: 10px; cursor: pointer; }
        .post-time { padding: 0 15px 15px; color: var(--secondary-color); font-size: 10px; text-transform: uppercase; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background: var(--card-bg); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-color); text-decoration: none; font-size: 22px; }
        .nav-item.active { color: var(--primary-color); }

        /* ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
        .profile-header { padding: 20px 15px 15px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .profile-info { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color); }
        .profile-stats { display: flex; justify-content: space-around; margin-bottom: 15px; }
        .profile-stat { display: flex; flex-direction: column; align-items: center; }
        .stat-count { font-weight: 600; font-size: 16px; }
        .stat-label { font-size: 12px; color: var(--secondary-color); }
        .profile-bio { font-size: 14px; margin-bottom: 10px; }
        .profile-tabs { display: flex; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .profile-tab { flex: 1; text-align: center; padding: 15px; font-weight: 600; cursor: pointer; border-bottom: 2px solid transparent; }
        .profile-tab.active { border-bottom-color: var(--text-color); }
        .profile-posts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
        .profile-post { aspect-ratio: 1; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: var(--secondary-color); }
        .profile-post img { width: 100%; height: 100%; object-fit: cover; }
        .profile-actions { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* Ø²Ø± Ø§Ù„ØªØ±Ù‚ÙŠØ© */
        .upgrade-btn { background: linear-gradient(45deg, #ffd700, #f7b733); color: #000; border: none; padding: 8px 15px; border-radius: 5px; font-size: 14px; font-weight: 600; cursor: pointer; }
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±Ù‚ÙŠØ© */
        .upgrade-modal-body { text-align: center; }
        .upgrade-modal-body h2 { color: var(--premium-color); font-size: 24px; margin-bottom: 10px; }
        .upgrade-modal-body ul { list-style: none; padding: 0; margin: 20px 0; text-align: right; }
        .upgrade-modal-body li { font-size: 16px; margin-bottom: 10px; }
        .upgrade-modal-body .fas { color: var(--success-color); margin-left: 10px; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (CSS Ø§Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯) */
        .modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }
        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease-out;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }
        .modal-content-full { width: 100%; height: 100%; max-height: 100vh; border-radius: 0; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; background: var(--card-bg); z-index: 10; border-radius: 12px 12px 0 0; }
        .modal-title { font-weight: 600; }
        .modal-close { cursor: pointer; font-size: 20px; }
        .modal-body { padding: 15px; overflow-y: auto; flex: 1; }

        /* ØªØ®ØµÙŠØµØ§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© */
        .file-attachment { display: flex; align-items: center; gap: 10px; padding: 10px 15px; background: #f5f5f5; margin: 10px 15px; border-radius: 8px; }
        .file-icon { font-size: 20px; color: var(--primary-color); }
        .file-info { flex: 1; }
        .file-name { font-weight: 600; font-size: 14px; }
        .file-size { font-size: 12px; color: var(--secondary-color); }
        .download-btn { background: var(--primary-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer; }
        .premium-lock { color: var(--premium-color); margin-left: 5px; }
        .content-warning { background: #ffebee; color: #c62828; padding: 10px; margin: 10px 15px; border-radius: 5px; font-size: 12px; text-align: center; border: 1px solid #ffcdd2; }
        .report-btn { color: var(--danger-color); font-size: 12px; cursor: pointer; margin-top: 5px; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² */
        .award-section { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 20px; margin: 15px; border-radius: 10px; text-align: center; }
        .award-title { font-size: 20px; font-weight: 700; margin-bottom: 10px; }
        .award-description { font-size: 14px; margin-bottom: 15px; }
        .award-prize { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .prize-item { text-align: center; }
        .prize-icon { font-size: 40px; margin-bottom: 10px; }
        .prize-name { font-size: 14px; font-weight: 600; }

        /* Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-color); color: var(--text-color); font-family: inherit; }
        .form-textarea { min-height: 100px; resize: vertical; }
        .form-submit { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px; }

        /* ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ù…Ø¹ Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ) */
        .chat-container { margin-top: 60px; height: calc(100vh - 120px); display: flex; flex-direction: column; }
        .chat-header { padding: 15px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        .chat-header-info { display: flex; align-items: center; gap: 10px; }
        .chat-header-icons { display: flex; gap: 15px; font-size: 18px; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 70%; padding: 10px 15px; border-radius: 18px; font-size: 14px; line-height: 1.4; }
        .message.sent { align-self: flex-end; background: var(--primary-color); color: white; border-bottom-right-radius: 5px; }
        .message.received { align-self: flex-start; background: var(--border-color); color: var(--text-color); border-bottom-left-radius: 5px; }
        .message audio { width: 100%; max-width: 250px; }
        .chat-input-container { padding: 15px; background: var(--card-bg); border-top: 1px solid var(--border-color); display: flex; gap: 10px; align-items: center; }
        .chat-input { flex: 1; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 25px; background: var(--bg-color); color: var(--text-color); }
        .send-btn { background: var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }
        .record-btn { background: var(--secondary-color); }
        .record-btn.recording { background: var(--danger-color); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }
        #recording-timer { flex: 1; text-align: center; color: var(--danger-color); font-weight: 600; display: none; }

        /* ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø« */
        .search-container { margin-top: 60px; padding: 15px; }
        .search-bar { width: 100%; padding: 12px 20px; border: 1px solid var(--border-color); border-radius: 25px; margin-bottom: 20px; }
        .search-tabs { display: flex; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .search-tab { padding: 10px 15px; cursor: pointer; border-bottom: 2px solid transparent; }
        .search-tab.active { border-bottom-color: var(--primary-color); color: var(--primary-color); }
        .search-results { display: flex; flex-direction: column; gap: 10px; }
        .search-result { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--card-bg); border-radius: 10px; border: 1px solid var(--border-color); }
        .result-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .result-info { flex: 1; }
        .result-name { font-weight: 600; margin-bottom: 5px; }
        .result-details { font-size: 12px; color: var(--secondary-color); }
        .follow-btn { background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 12px; cursor: pointer; }
        .follow-btn.following { background: var(--secondary-color); }

        /* ØµÙØ­Ø© Ø§Ù„Ù…ØªÙ…ÙŠØ²ÙŠÙ† */
        .leaderboard-container { margin-top: 60px; padding: 15px; }
        .leaderboard-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--card-bg); border-radius: 10px; margin-bottom: 10px; border: 1px solid var(--border-color); }
        .leaderboard-rank { width: 30px; height: 30px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .leaderboard-user { flex: 1; }
        .leaderboard-score { font-weight: 600; color: var(--premium-color); }
        
        /* Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© (Ø¬Ø¯ÙŠØ¯) */
        .calculator-body {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 Ø£Ø¹Ù…Ø¯Ø© */
            gap: 8px;
        }
        .calc-display {
            grid-column: 1 / -1;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 15px;
            text-align: left;
            font-size: 28px;
            border-radius: 5px;
            margin-bottom: 10px;
            min-height: 60px;
            word-wrap: break-word;
            word-break: break-all;
        }
        .calc-btn {
            padding: 15px 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #e0e0e0;
            color: var(--text-color);
            font-weight: 600;
        }
        .calc-btn.operator { background: var(--warning-color); color: #000; }
        .calc-btn.clear { background: var(--danger-color); color: white; }
        .calc-btn.num { background: #f0f0f0; }
        .calc-btn.equal { background: var(--success-color); color: white; grid-row: span 2; }
        .calc-btn.zero { grid-column: span 2; }

        /* Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø§ØµÙ‚Ø© (ØªØ¹Ø¯ÙŠÙ„: Ù…Ø¹ Ø¹Ù†ÙˆØ§Ù†) */
        .sticky-notes-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 15px; }
        .sticky-note { background: #ffeb3b; padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); min-height: 150px; position: relative; display: flex; flex-direction: column; }
        .sticky-note-header { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; border-bottom: 1px dashed rgba(0,0,0,0.3); }
        .sticky-note-title { border: none; background: transparent; font-weight: 600; font-size: 16px; width: 100%; padding: 5px; }
        .sticky-note-title:focus { outline: none; background: rgba(255,255,255,0.5); }
        .sticky-note-actions { display: flex; gap: 5px; }
        .sticky-note-action { background: none; border: none; cursor: pointer; font-size: 14px; padding: 5px; }
        .sticky-note-action:hover { background: rgba(0,0,0,0.1); border-radius: 5px; }
        .sticky-note-content { width: 100%; flex: 1; min-height: 100px; border: none; background: transparent; resize: none; font-family: inherit; font-size: 15px; padding-top: 10px; }
        .sticky-note-content:focus { outline: none; background: rgba(255,255,255,0.5); }

        /* Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        .whiteboard-container { width: 100%; height: 500px; border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; background: white; touch-action: none; }
        #whiteboard-canvas { width: 100%; height: 100%; }
        .whiteboard-tools { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .whiteboard-tool { padding: 8px 12px; border: 1px solid var(--border-color); background: white; border-radius: 5px; cursor: pointer; }
        .whiteboard-tool.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ */
        .upload-speed-indicator { padding: 10px; background: #e8f5e8; border-radius: 5px; margin-bottom: 10px; text-align: center; font-weight: 600; }
        .upload-speed-rocket { background: #d4edda; color: #155724; animation: rocketPulse 1s infinite; }
        @keyframes rocketPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
        @media (prefers-color-scheme: dark) {
            :root { --bg-color: #000; --card-bg: #121212; --border-color: #363636; --text-color: #f5f5f5; --secondary-color: #a8a8a8; }
            .sticky-note { background: #424242; color: #f5f5f5; }
            .sticky-note-title { color: #f5f5f5; }
            .whiteboard-tool { background: var(--bg-color); color: var(--text-color); }
            .whiteboard-container { background: #f0f0f0; }
        }
    </style>
</head>
<body>
    <div class="login-screen" id="login-screen">
        <div class="login-container">
            <div class="logo-large">The Academy</div>
            <div class="login-form">
                <input type="text" class="login-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" id="login-email">
                <input type="password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="login-password">
                <button class="login-btn" id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <div class="separator">Ø£Ùˆ</div>
                <button class="login-btn" style="background: #4285f4;" id="google-login">
                    <i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
                </button>
                <button class="login-btn" style="background: #007bff;" id="phone-login-btn">
                    <i class="fas fa-phone"></i> Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                </button>
            </div>
            <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; text-align: center;">
                <span style="font-size: 14px;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
                <a href="#" class="signup-link" id="show-signup"> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
            </div>
            <div style="margin-top: 20px; font-size: 12px; color: var(--secondary-color);">
                <p>Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <strong>Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</strong> Ùˆ<strong>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¢Ù…Ù†</strong>.</p>
            </div>
        </div>
    </div>

    <div class="login-screen" id="signup-screen" style="display: none;">
        <div class="login-container">
            <div class="logo-large">The Academy</div>
            <div class="login-form">
                <input type="text" class="login-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" id="signup-name">
                <input type="text" class="login-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" id="signup-username">
                <input type="email" class="login-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" id="signup-email">
                <input type="password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="signup-password">
                <select class="login-input" id="signup-role">
                    <option value="">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ùƒ</option>
                    <option value="student">Ø·Ø§Ù„Ø¨</option>
                    <option value="teacher">Ø£Ø³ØªØ§Ø°</option>
                </select>
                <button class="login-btn" id="signup-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                <div class="separator">Ø£Ùˆ</div>
                <button class="login-btn" style="background: #4285f4;" id="google-signup-btn">
                    <i class="fab fa-google"></i> Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
                </button>
                <button class="login-btn" style="background: #007bff;" id="phone-signup-btn">
                    <i class="fas fa-phone"></i> Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                </button>
            </div>
            <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; text-align: center;">
                <span style="font-size: 14px;">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</span>
                <a href="#" class="signup-link" id="show-login"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
            </div>
        </div>
    </div>

    <div class="app-content" id="app-content">
        <div class="header">
            <div class="header-icons">
                <i class="header-icon fas fa-robot" id="fahmi-ai-btn" title="FAHMI-Ai"></i>
                <i class="header-icon fas fa-calculator" id="calculator-btn" title="Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©"></i>
                <i class="header-icon fas fa-sticky-note" id="sticky-notes-btn" title="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></i>
                <i class="header-icon fas fa-chalkboard" id="whiteboard-btn" title="Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡"></i>
            </div>
            <div class="logo">The Academy</div>
            <div class="header-profile">
                <i class="header-icon fas fa-paper-plane" id="messages-btn" title="Ø§Ù„Ø±Ø³Ø§Ø¦Ù„"></i>
                <div class="header-profile-icon" id="user-profile-btn">
                    <img src="https://i.pravatar.cc/35?img=5" alt="Profile" id="header-user-avatar">
                </div>
            </div>
        </div>

        <div id="home-page">
            <div class="award-section">
                </div>
            <div class="stories-container">
                <div class="stories" id="stories-list">
                    <div class="story" id="add-story-btn">
                        <div class="story-avatar-add">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="story-username">Ù‚ØµØªÙƒ</div>
                    </div>
                    </div>
            </div>
            <div class="feed-tabs">
                <div class="feed-tab active">Ù„Ù„Ø¬Ù…ÙŠØ¹</div>
                <div class="feed-tab">Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</div>
                <div class="feed-tab">Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            </div>
            <div class="feed" id="feed-container">
                </div>
        </div>

        <div id="search-page" style="display: none;">
            <div class="search-container">
                <input type="text" class="search-bar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ Ø£Ø³Ø§ØªØ°Ø©..." id="search-input">
                <div class="search-tabs">
                    <div class="search-tab active" data-type="all">Ø§Ù„Ø¬Ù…ÙŠØ¹</div>
                    <div class="search-tab" data-type="teachers">Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</div>
                </div>
                <div class="search-results" id="search-results"></div>
            </div>
        </div>

        <div id="chat-page" style="display: none;">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-header-info">
                        <img src="https://i.pravatar.cc/40?img=7" alt="Ù…Ø¬Ù…ÙˆØ¹Ø©" style="width:40px; height:40px; border-radius:50%;">
                        <div>
                            <div style="font-weight: 600;" id="chat-title">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</div>
                            <div style="font-size: 12px; color: var(--secondary-color);">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©: 12</div>
                        </div>
                    </div>
                    <div class="chat-header-icons">
                        <i class="fas fa-info-circle"></i>
                    </div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." id="chat-message-input">
                    <div id="recording-timer">00:00</div>
                    <button class="send-btn" id="send-message-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="send-btn record-btn" id="record-audio-btn">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="leaderboard-page" style="display: none;">
            <div class="leaderboard-container">
                <h2 style="margin-bottom: 20px; text-align: center;">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹)</h2>
                <div id="leaderboard-list">
                    </div>
            </div>
        </div>

        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home-page"><i class="fas fa-home"></i></a>
            <a href="#" class="nav-item" data-page="search-page"><i class="fas fa-search"></i></a>
            <a href="#" class="nav-item" id="create-post-nav-btn"><i class="fas fa-plus-square"></i></a>
            <a href="#" class="nav-item" data-page="chat-page"><i class="fas fa-comments"></i></a>
            <a href="#" class="nav-item" data-page="leaderboard-page"><i class="fas fa-trophy"></i></a>
        </div>
    </div>

    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</div>
                <div class="modal-close" data-modal="profile-modal">Ã—</div>
            </div>
            <div class="modal-body" style="padding:0;">
                <div class="profile-header">
                    <div class="profile-info">
                        <img src="https://i.pravatar.cc/80?img=5" alt="Profile" class="profile-avatar" id="modal-profile-avatar">
                        <div style="flex:1;">
                            <div style="font-weight:600; font-size:20px; margin-bottom:5px;" id="modal-profile-name">...</div>
                            <div style="color:var(--secondary-color); font-size:14px;" id="modal-profile-role">...</div>
                            <button class="upgrade-btn" id="upgrade-btn">
                                <i class="fas fa-crown"></i> Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ PRO
                            </button>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="profile-stat"><div class="stat-count" id="modal-posts-count">0</div><div class="stat-label">Ù…Ù†Ø´ÙˆØ±</div></div>
                        <div class="profile-stat"><div class="stat-count" id="modal-followers-count">0</div><div class="stat-label">Ù…ØªØ§Ø¨Ø¹</div></div>
                        <div class="profile-stat"><div class="stat-count" id="modal-following-count">0</div><div class="stat-label">Ù…ØªØ§Ø¨ÙØ¹</div></div>
                    </div>
                    <div class="profile-bio" id="modal-profile-bio">...</div>
                </div>
                <div class="profile-actions">
                    <button class="form-submit" id="edit-profile-btn" style="background-color: var(--secondary-color);">
                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    </button>
                    <button class="form-submit" id="logout-btn" style="background: var(--danger-color);">
                        <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>
                <div class="profile-tabs">
                    <div class="profile-tab active"><i class="fas fa-th"></i></div>
                    <div class="profile-tab"><i class="fas fa-bookmark"></i></div>
                </div>
                <div class="profile-posts" id="modal-profile-posts"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="create-post-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</div>
                <div class="modal-close" data-modal="create-post-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <div id="upload-speed-info" class="upload-speed-indicator">
                    âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„: Ø¹Ø§Ø¯ÙŠØ©
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù†Øµ</label>
                    <textarea class="form-textarea" placeholder="Ø§ÙƒØªØ¨ Ø´Ø±Ø­Ø§Ù‹..." id="post-content-input"></textarea>
                    <div class="character-count" style="text-align:left; margin-top:5px;">
                        <span id="post-char-count">0</span>/1000 Ø­Ø±Ù (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ)
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠØ¯ÙŠÙˆ (Ø±Ø§Ø¨Ø· Youtube)</label>
                    <input type="text" class="form-input" placeholder="https://youtube.com/..." id="post-video-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø±ÙØ¹ Ù…Ù„Ù (ØµÙˆØ±Ø©ØŒ ÙÙŠØ¯ÙŠÙˆØŒ PDF)</label>
                    <input type="file" class="form-input" id="post-file-input" accept="image/*,video/*,application/pdf">
                    <div style="font-size:12px; color:var(--secondary-color); margin-top:5px;">
                        Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¹Ø§Ø¯ÙŠ: 100MB / 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
                    </div>
                </div>
                <div id="post-upload-progress" style="display:none; margin-bottom: 10px;">
                    Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹: <progress value="0" max="100"></progress> <span id="upload-percentage">0%</span>
                </div>
                <button class="form-submit" id="submit-post-btn">Ù†Ø´Ø±</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="calculator-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø¹Ù„Ù…ÙŠØ©</div>
                <div class="modal-close" data-modal="calculator-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <div class="calculator-body">
                    <div class="calc-display" id="calc-display">0</div>
                    
                    <button class="calc-btn operator" data-type="op-sci" data-val="sin">sin</button>
                    <button class="calc-btn operator" data-type="op-sci" data-val="cos">cos</button>
                    <button class="calc-btn operator" data-type="op-sci" data-val="tan">tan</button>
                    <button class="calc-btn operator" data-type="op" data-val="^">xÊ¸</button>
                    <button class="calc-btn operator" data-type="op-sci" data-val="sqrt">âˆš</button>
                    
                    <button class="calc-btn operator" data-type="op-sci" data-val="log">log</button>
                    <button class="calc-btn operator" data-type="op-sci" data-val="ln">ln</button>
                    <button class="calc-btn operator" data-type="op" data-val="(">(</button>
                    <button class="calc-btn operator" data-type="op" data-val=")">)</button>
                    <button class="calc-btn operator" data-type="op-sci" data-val="!">n!</button>
                    
                    <button class="calc-btn clear" data-type="clear" data-val="C">C</button>
                    <button class="calc-btn operator" data-type="op" data-val="/">/</button>
                    <button class="calc-btn operator" data-type="op" data-val="*">x</button>
                    <button class="calc-btn operator" data-type="op" data-val="-">-</button>
                    <button class="calc-btn operator equal" data-type="equal" data-val="=">=</button>
                    
                    <button class="calc-btn num" data-type="num" data-val="7">7</button>
                    <button class="calc-btn num" data-type="num" data-val="8">8</button>
                    <button class="calc-btn num" data-type="num" data-val="9">9</button>
                    <button class="calc-btn operator" data-type="op" data-val="+">+</button>
                    
                    <button class="calc-btn num" data-type="num" data-val="4">4</button>
                    <button class="calc-btn num" data-type="num" data-val="5">5</button>
                    <button class="calc-btn num" data-type="num" data-val="6">6</button>
                    
                    <button class="calc-btn num" data-type="num" data-val="1">1</button>
                    <button class="calc-btn num" data-type="num" data-val="2">2</button>
                    <button class="calc-btn num" data-type="num" data-val="3">3</button>

                    <button class="calc-btn num zero" data-type="num" data-val="0">0</button>
                    <button class="calc-btn" data-type="decimal" data-val=".">.</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="fahmi-ai-modal">
        </div>

    <div class="modal" id="sticky-notes-modal">
        <div class="modal-content modal-content-full">
            <div class="modal-header">
                <div class="modal-title">Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ Ø§Ù„Ù„Ø§ØµÙ‚Ø©</div>
                <div class="modal-close" data-modal="sticky-notes-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <button class="form-submit" id="add-sticky-note" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <div class="sticky-notes-container" id="sticky-notes-container"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="whiteboard-modal">
        <div class="modal-content modal-content-full">
            <div class="modal-header">
                <div class="modal-title">Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡</div>
                <div class="modal-close" data-modal="whiteboard-modal">Ã—</div>
            </div>
            <div class="modal-body" style="padding:0; display:flex; flex-direction:column;">
                <div class="whiteboard-tools">
                    <button class="whiteboard-tool active" data-tool="pen">âœï¸ Ù‚Ù„Ù…</button>
                    <button class="whiteboard-tool" data-tool="eraser">ğŸ§½ Ù…Ù…Ø­Ø§Ø©</button>
                    <input type="color" id="whiteboard-color" value="#000000" style="border:none; background:transparent; width: 40px; height: 40px; cursor:pointer;">
                    <input type="range" id="whiteboard-width" min="1" max="20" value="3" style="margin: 0 10px; cursor:pointer;">
                    <button class="whiteboard-tool" id="clear-whiteboard">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                </div>
                <div class="whiteboard-container">
                    <canvas id="whiteboard-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="phone-login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                <div class="modal-close" data-modal="phone-login-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <div id="phone-step-1">
                    <p>Ø³ÙˆÙ Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ© (SMS) ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ ØªØ­Ù‚Ù‚.</p>
                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©)</label>
                        <input type="tel" class="form-input" placeholder="+21612345678" id="phone-number-input">
                    </div>
                    <div id="recaptcha-container" style="margin-top: 15px;"></div>
                    <button class="form-submit" id="send-otp-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯</button>
                </div>
                <div id="phone-step-2" style="display: none;">
                    <p>Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ <span id="phone-display"></span></p>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (OTP)</label>
                        <input type="text" class="form-input" placeholder="123456" id="otp-input" maxlength="6">
                    </div>
                    <button class="form-submit" id="confirm-otp-btn">ØªØ£ÙƒÙŠØ¯ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="story-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù‚ØµØªÙƒ</div>
                <div class="modal-close" data-modal="story-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Ø§ÙƒØªØ¨ Ø­Ø§Ù„ØªÙƒ (25 Ø­Ø±ÙØ§Ù‹ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)</label>
                    <input type="text" class="form-input" placeholder="Ø£Ø¯Ø±Ø³ Ø§Ù„Ø¢Ù†..." id="story-text-input" maxlength="25">
                </div>
                <button class="form-submit" id="save-story-btn">Ù†Ø´Ø± Ø§Ù„Ù‚ØµØ©</button>
                <button class="form-submit" id="delete-story-btn" style="background:var(--danger-color); margin-top:10px; display:none;">Ø­Ø°Ù Ø§Ù„Ù‚ØµØ©</button>
            </div>
        </div>
    </div>

    <div class="modal" id="upgrade-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ The Academy PRO</div>
                <div class="modal-close" data-modal="upgrade-modal">Ã—</div>
            </div>
            <div class="modal-body upgrade-modal-body">
                <h2><i class="fas fa-crown"></i> Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ PRO</h2>
                <p>Ø§ÙØªØ­ Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ© Ù„ØªØ³Ø±ÙŠØ¹ Ø¯Ø±Ø§Ø³ØªÙƒ!</p>
                <ul>
                    <li><i class="fas fa-check"></i> <strong>Ù‚ØµØµ (Ø³ØªÙˆØ±ÙŠ) ØªØ¨Ù‚Ù‰ Ù„Ù…Ø¯Ø© 7 Ø£ÙŠØ§Ù…</strong> Ù…Ø¹ Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ.</li>
                    <li><i class="fas fa-check"></i> <strong>Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¶Ø®Ù…Ø©</strong> (ÙÙŠØ¯ÙŠÙˆ ÙˆÙ…Ù„ÙØ§Øª Ø£ÙƒØ¨Ø± Ù…Ù† 100MB).</li>
                    <li><i class="fas fa-check"></i> <strong>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 15 Ø¯Ù‚ÙŠÙ‚Ø©</strong> (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚).</li>
                    <li><i class="fas fa-check"></i> <strong>Ø±Ø³Ø§Ø¦Ù„ ØµÙˆØªÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ 15 Ø¯Ù‚ÙŠÙ‚Ø©</strong> (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚).</li>
                    <li><i class="fas fa-check"></i> <strong>Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ ØµØ§Ø±ÙˆØ®ÙŠØ©</strong> ğŸš€.</li>
                    <li><i class="fas fa-check"></i> Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø£Ø³Ø±Ø¹.</li>
                </ul>
                <button class="form-submit" id="confirm-upgrade-btn">Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¢Ù† (Ù‚Ø±ÙŠØ¨Ø§Ù‹)</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
                <div class="modal-close" data-modal="edit-profile-modal">Ã—</div>
            </div>
            <div class="modal-body">
                <div class="form-group" style="text-align: center;">
                    <img src="https://i.pravatar.cc/80" id="edit-avatar-preview" class="profile-avatar" style="margin-bottom: 10px; cursor: pointer;">
                    <input type="file" id="edit-avatar-input" accept="image/*" style="display: none;">
                    <button class="form-submit" style="width: auto; padding: 5px 10px; background: var(--secondary-color);" id="change-avatar-btn">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" class="form-input" id="edit-name-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="edit-username-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© (Bio)</label>
                    <textarea class="form-textarea" id="edit-bio-input"></textarea>
                </div>
                <button class="form-submit" id="save-profile-btn">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>
    ```

---

#### â¬‡ï¸ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ: JavaScript (Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø«Ø§Ù†ÙŠØ§Ù‹)

```javascript
    <script>
        // === ØªÙ‡ÙŠØ¦Ø© Firebase ===
        const firebaseConfig = {
            apiKey: "AIzaSyB-fNvLU-1CdlgwjG4Nst3FGTAezEmlGdA",
            authDomain: "the-academy-b3316.firebaseapp.com",
            databaseURL: "https://the-academy-b3316-default-rtdb.firebaseio.com",
            projectId: "the-academy-b3316",
            storageBucket: "the-academy-b3316.firebasestorage.app",
            messagingSenderId: "780594810246",
            appId: "1:780594810246:web:4af762ceb98120752db007",
            measurementId: "G-QPET9CS9ES"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // === Ù…ØªØºÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        let currentUser = null;
        let userData = null;
        let activeChat = 'general';
        let isPremiumUser = false;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØªÙŠØ©
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingTimerInterval;
        let recordingStartTime;
        
        document.addEventListener('DOMContentLoaded', function() {
            // === ØªØ¹Ø±ÙŠÙ Ø¹Ù†Ø§ØµØ± DOM ===
            const loginScreen = document.getElementById('login-screen');
            const signupScreen = document.getElementById('signup-screen');
            const appContent = document.getElementById('app-content');
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            const googleLoginBtn = document.getElementById('google-login');
            const phoneLoginBtn = document.getElementById('phone-login-btn');
            const googleSignupBtn = document.getElementById('google-signup-btn');
            const phoneSignupBtn = document.getElementById('phone-signup-btn');
            const showSignup = document.getElementById('show-signup');
            const showLogin = document.getElementById('show-login');
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('[id$="-page"]');
            
            // Ø§Ù„Ù†ÙˆØ§ÙØ°
            const profileModal = document.getElementById('profile-modal');
            const createPostModal = document.getElementById('create-post-modal');
            const calculatorModal = document.getElementById('calculator-modal');
            const fahmiAiModal = document.getElementById('fahmi-ai-modal');
            const stickyNotesModal = document.getElementById('sticky-notes-modal');
            const whiteboardModal = document.getElementById('whiteboard-modal');
            const phoneLoginModal = document.getElementById('phone-login-modal');
            const storyModal = document.getElementById('story-modal');
            const upgradeModal = document.getElementById('upgrade-modal');
            const editProfileModal = document.getElementById('edit-profile-modal');
            
            // Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            const userProfileBtn = document.getElementById('user-profile-btn');
            const calculatorBtn = document.getElementById('calculator-btn');
            const fahmiAiBtn = document.getElementById('fahmi-ai-btn');
            const messagesBtn = document.getElementById('messages-btn');
            const stickyNotesBtn = document.getElementById('sticky-notes-btn');
            const whiteboardBtn = document.getElementById('whiteboard-btn');
            const createPostNavBtn = document.getElementById('create-post-nav-btn');
            const upgradeBtn = document.getElementById('upgrade-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³ØªÙˆØ±ÙŠ
            const addStoryBtn = document.getElementById('add-story-btn');
            const saveStoryBtn = document.getElementById('save-story-btn');
            const deleteStoryBtn = document.getElementById('delete-story-btn');
            const storyTextInput = document.getElementById('story-text-input');
            
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØªÙŠØ©)
            const chatMessageInput = document.getElementById('chat-message-input');
            const sendMessageBtn = document.getElementById('send-message-btn');
            const recordAudioBtn = document.getElementById('record-audio-btn');
            const recordingTimerDisplay = document.getElementById('recording-timer');

            // === 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ===
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    if (user.providerData.some(p => p.providerId === 'password') && !user.emailVerified) {
                        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯.', 'warning');
                        user.sendEmailVerification();
                        auth.signOut();
                        return;
                    }
                    currentUser = user;
                    loadUserData(user.uid);
                    loginScreen.style.display = 'none';
                    signupScreen.style.display = 'none';
                    appContent.style.display = 'block';
                } else {
                    currentUser = null;
                    userData = null;
                    isPremiumUser = false;
                    loginScreen.style.display = 'flex';
                    appContent.style.display = 'none';
                }
            });

            function loadUserData(uid) {
                db.ref('users/' + uid).on('value', (snapshot) => {
                    userData = snapshot.val();
                    if (userData) {
                        isPremiumUser = userData.isPremium || false;
                        updateUIWithUserData();
                        loadPosts();
                        loadStories();
                        loadLeaderboard();
                        updateUploadSpeedIndicator();
                        
                        if (isPremiumUser) {
                            upgradeBtn.textContent = 'Ø£Ù†Øª Ø¹Ø¶Ùˆ PRO Ø¨Ø§Ù„ÙØ¹Ù„ ğŸ‘‘';
                            upgradeBtn.disabled = true;
                        } else {
                            upgradeBtn.textContent = 'Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ PRO ğŸš€';
                            upgradeBtn.disabled = false;
                        }
                    }
                });
            }

            function updateUIWithUserData() {
                const avatar = userData.avatar || 'https://i.pravatar.cc/80';
                document.getElementById('header-user-avatar').src = avatar;
                document.getElementById('modal-profile-name').textContent = userData.name;
                document.getElementById('modal-profile-role').textContent = (userData.role === 'teacher' ? 'Ø£Ø³ØªØ§Ø°' : 'Ø·Ø§Ù„Ø¨');
                document.getElementById('modal-profile-avatar').src = avatar;
                document.getElementById('modal-profile-bio').textContent = userData.bio || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©...';
                document.getElementById('modal-followers-count').textContent = (userData.followers ? Object.keys(userData.followers).length : 0);
                document.getElementById('modal-following-count').textContent = (userData.following ? Object.keys(userData.following).length : 0);
            }
            
            function updateUploadSpeedIndicator() {
                const speedIndicator = document.getElementById('upload-speed-info');
                if (isPremiumUser) {
                    speedIndicator.textContent = 'ğŸš€ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„: ØµØ§Ø±ÙˆØ®ÙŠØ© (Ù…Ø­Ø§ÙƒØ§Ø©)';
                    speedIndicator.className = 'upload-speed-indicator upload-speed-rocket';
                } else {
                    speedIndicator.textContent = 'âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„: Ø¹Ø§Ø¯ÙŠØ©';
                    speedIndicator.className = 'upload-speed-indicator';
                }
            }
            
            showSignup.addEventListener('click', (e) => { e.preventDefault(); loginScreen.style.display = 'none'; signupScreen.style.display = 'flex'; });
            showLogin.addEventListener('click', (e) => { e.preventDefault(); signupScreen.style.display = 'none'; loginScreen.style.display = 'flex'; });

            // === 2. ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚) ===
            
            loginBtn.addEventListener('click', function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                if (!email || !password) return showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'warning');

                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        if (!userCredential.user.emailVerified) {
                            showNotification('ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ­Ù‚Ù‚ Ø¬Ø¯ÙŠØ¯.', 'warning');
                            userCredential.user.sendEmailVerification();
                            auth.signOut();
                        } else {
                            showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!', 'success');
                        }
                    })
                    .catch((error) => showNotification('Ø®Ø·Ø£: ' + error.message, 'error'));
            });
            
            signupBtn.addEventListener('click', function() {
                const name = document.getElementById('signup-name').value;
                const username = document.getElementById('signup-username').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const role = document.getElementById('signup-role').value;
                
                if (!name || !username || !email || !password || !role) {
                    return showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'warning');
                }

                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        user.sendEmailVerification().then(() => {
                            showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨.', 'success');
                        });

                        return db.ref('users/' + user.uid).set({
                            name: name,
                            username: username,
                            email: email,
                            role: role,
                            createdAt: firebase.database.ServerValue.TIMESTAMP,
                            profileComplete: false,
                            engagementPoints: 0,
                            isPremium: false,
                            avatar: 'https://i.pravatar.cc/80'
                        });
                    })
                    .then(() => auth.signOut())
                    .catch((error) => showNotification('Ø®Ø·Ø£: ' + error.message, 'error'));
            });

            // === 3. Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¬ÙˆØ¬Ù„ ÙˆØ§Ù„Ù‡Ø§ØªÙ ===
            
            function handleGoogleSignIn() {
                auth.signInWithPopup(googleProvider)
                    .then((result) => {
                        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        if (result.additionalUserInfo.isNewUser) {
                            const user = result.user;
                            return db.ref('users/' + user.uid).set({
                                name: user.displayName,
                                username: user.email.split('@')[0],
                                email: user.email,
                                role: 'student',
                                createdAt: firebase.database.ServerValue.TIMESTAMP,
                                profileComplete: false,
                                engagementPoints: 0,
                                isPremium: false,
                                avatar: user.photoURL || 'https://i.pravatar.cc/80'
                            });
                        }
                    }).catch((error) => showNotification('Ø®Ø·Ø£: ' + error.message, 'error'));
            }
            googleLoginBtn.addEventListener('click', handleGoogleSignIn);
            googleSignupBtn.addEventListener('click', handleGoogleSignIn);

            const phoneStep1 = document.getElementById('phone-step-1');
            const phoneStep2 = document.getElementById('phone-step-2');
            let confirmationResult = null;
            
            function handlePhoneSignIn(e) {
                e.preventDefault();
                phoneLoginModal.classList.add('active');
                phoneStep1.style.display = 'block';
                phoneStep2.style.display = 'none';
                
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                  'size': 'invisible',
                  'callback': () => {}
                });
                window.recaptchaVerifier.render().catch(err => {
                    showNotification('Ø®Ø·Ø£ ReCaptcha. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ Ø¹Ù„Ù‰ Ø¯ÙˆÙ…ÙŠÙ† Ù…ØµØ±Ø­ Ø¨Ù‡.', 'error');
                });
            }
            phoneLoginBtn.addEventListener('click', handlePhoneSignIn);
            phoneSignupBtn.addEventListener('click', handlePhoneSignIn);

            document.getElementById('send-otp-btn').addEventListener('click', () => {
                const phoneNumber = document.getElementById('phone-number-input').value;
                const appVerifier = window.recaptchaVerifier;
                if (!phoneNumber.startsWith('+')) return showNotification('Ø§Ù„Ø±Ù‚Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ + (Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©)', 'warning');
                
                auth.signInWithPhoneNumber(phoneNumber, appVerifier)
                    .then((result) => {
                        confirmationResult = result;
                        showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯!', 'success');
                        phoneStep1.style.display = 'none';
                        phoneStep2.style.display = 'block';
                        document.getElementById('phone-display').textContent = phoneNumber;
                    }).catch((error) => showNotification('Ø®Ø·Ø£: ' + error.message, 'error'));
            });

            document.getElementById('confirm-otp-btn').addEventListener('click', () => {
                const code = document.getElementById('otp-input').value;
                if (!code || code.length !== 6) return showNotification('ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦', 'warning');

                confirmationResult.confirm(code)
                    .then((result) => {
                        const user = result.user;
                        db.ref('users/' + user.uid).once('value', (snapshot) => {
                            if (!snapshot.exists()) {
                                return db.ref('users/' + user.uid).set({
                                    name: 'Ù…Ø³ØªØ®Ø¯Ù… ' + user.uid.substring(0, 5),
                                    username: user.phoneNumber,
                                    phone: user.phoneNumber,
                                    role: 'student',
                                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                                    profileComplete: false,
                                    engagementPoints: 0,
                                    isPremium: false,
                                    avatar: 'https://i.pravatar.cc/80'
                                });
                            }
                        });
                        phoneLoginModal.classList.remove('active');
                    }).catch((error) => showNotification('Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.', 'error'));
            });

            // === 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ØªÙˆØ±ÙŠ (Ø§Ù„Ø­Ø§Ù„Ø©) ===
            addStoryBtn.addEventListener('click', () => {
                if (!userData) return;
                db.ref('stories/' + currentUser.uid).once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        storyTextInput.value = snapshot.val().text;
                        deleteStoryBtn.style.display = 'block';
                    } else {
                        storyTextInput.value = '';
                        deleteStoryBtn.style.display = 'none';
                    }
                });
                storyModal.classList.add('active');
            });

            saveStoryBtn.addEventListener('click', () => {
                const text = storyTextInput.value.trim();
                if (!text) return showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø­Ø§Ù„Ø©', 'warning');
                
                const now = firebase.database.ServerValue.TIMESTAMP;
                const duration = isPremiumUser ? (1000*60*60*24*7) : (1000*60*60*24);
                
                db.ref('stories/' + currentUser.uid).set({
                    text: text,
                    userId: currentUser.uid,
                    createdAt: now,
                    duration: duration, 
                    isPremiumStory: isPremiumUser
                }).then(() => {
                    showNotification('ØªÙ… Ù†Ø´Ø± Ù‚ØµØªÙƒ!', 'success');
                    addEngagementPoints(3);
                    storyModal.classList.remove('active');
                });
            });
            
            deleteStoryBtn.addEventListener('click', () => {
                db.ref('stories/' + currentUser.uid).remove().then(() => {
                    showNotification('ØªÙ… Ø­Ø°Ù Ù‚ØµØªÙƒ', 'success');
                    storyModal.classList.remove('active');
                });
            });

            function loadStories() {
                const container = document.getElementById('stories-list');
                db.ref('stories').on('value', (snapshot) => {
                    container.querySelectorAll('.story:not(#add-story-btn)').forEach(el => el.remove());
                    const stories = snapshot.val();
                    if (!stories) return;
                    const now = Date.now();
                    
                    Object.keys(stories).forEach(storyId => {
                        const story = stories[storyId];
                        const expiresAt = story.createdAt + story.duration;
                        
                        if (now > expiresAt) {
                            if(story.userId === currentUser?.uid) db.ref('stories/' + story.userId).remove();
                            return;
                        }
                        
                        db.ref('users/' + story.userId).once('value', (userSnap) => {
                            const user = userSnap.val();
                            if (!user) return;
                            
                            const storyElement = document.createElement('div');
                            storyElement.className = 'story';
                            storyElement.innerHTML = `
                                <div class="story-avatar ${story.isPremiumStory ? 'premium-story' : ''}">
                                    <img src="${user.avatar || 'https://i.pravatar.cc/56'}" alt="${user.name}">
                                </div>
                                <div class="story-text">${story.text}</div>
                            `;
                            container.appendChild(storyElement);
                        });
                    });
                });
            }

            // === 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª (Ù…Ø¹ ÙØ­Øµ Ø§Ù„ØªØ±Ù‚ÙŠØ©) ===
            
            function checkVideoDuration(file) {
                return new Promise((resolve, reject) => {
                    const videoElement = document.createElement('video');
                    videoElement.preload = 'metadata';
                    videoElement.onloadedmetadata = function() {
                        URL.revokeObjectURL(videoElement.src);
                        const duration = videoElement.duration;
                        const maxDurationNormal = 5 * 60;
                        const maxDurationPremium = 15 * 60;

                        if (isPremiumUser && duration > maxDurationPremium) {
                            reject(new Error(`Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù…ÙŠØ² (Ø§Ù„Ø­Ø¯ 15 Ø¯Ù‚ÙŠÙ‚Ø©).`));
                        } else if (!isPremiumUser && duration > maxDurationNormal) {
                            reject(new Error(`Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5 Ø¯Ù‚Ø§Ø¦Ù‚. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ø±ÙØ¹ 15 Ø¯Ù‚ÙŠÙ‚Ø©.`));
                        } else {
                            resolve();
                        }
                    };
                    videoElement.onerror = () => reject(new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ."));
                    videoElement.src = URL.createObjectURL(file);
                });
            }
            
            document.getElementById('submit-post-btn').addEventListener('click', async function() {
                const content = document.getElementById('post-content-input').value;
                const videoUrl = document.getElementById('post-video-input').value;
                const file = document.getElementById('post-file-input').files[0];
                
                if (!content && !file && !videoUrl) return showNotification('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰', 'warning');
                if (!isContentSafe(content)) return showNotification('ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ø©.', 'error');
                if (!isPremiumUser && content.length > 1000) return showNotification('Ø§Ù„Ù†Øµ ÙŠØªØ¬Ø§ÙˆØ² 1000 Ø­Ø±Ù (Ù„Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†)', 'warning');

                this.disabled = true;
                
                if (file) {
                    if (!isPremiumUser && file.type.startsWith('video/') && file.size > 100 * 1024 * 1024) {
                        showNotification('Ø­Ø¬Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØªØ¬Ø§ÙˆØ² 100MB (Ù„Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†). Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©!', 'warning');
                        this.disabled = false;
                        return;
                    }
                    if (file.type.startsWith('video/')) {
                        try {
                            await checkVideoDuration(file);
                        } catch (error) {
                            showNotification(error.message, 'warning');
                            this.disabled = false;
                            return;
                        }
                    }
                    uploadFile(file, content, videoUrl);
                } else {
                    savePost(content, videoUrl, null, null, null, null);
                }
            });

            function uploadFile(file, content, videoUrl) {
                const fileRef = storage.ref(`posts/${currentUser.uid}/${Date.now()}_${file.name}`);
                const uploadTask = fileRef.put(file);
                const progressDiv = document.getElementById('post-upload-progress');
                progressDiv.style.display = 'block';
                const progressBar = progressDiv.querySelector('progress');
                const progressSpan = document.getElementById('upload-percentage');

                uploadTask.on('state_changed', (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    let speedMultiplier = isPremiumUser ? 3 : 1;
                    const simulatedProgress = Math.min(progress * speedMultiplier, 100);
                    progressBar.value = simulatedProgress;
                    progressSpan.textContent = Math.round(simulatedProgress) + '%';
                }, (error) => {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ' + error.message, 'error');
                }, () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        savePost(content, videoUrl, downloadURL, file.type, file.name, file.size);
                    });
                });
            }

            function savePost(content, videoUrl, fileUrl, fileType, fileName, fileSize) {
                const postData = {
                    content: content,
                    videoUrl: videoUrl,
                    fileUrl: fileUrl,
                    fileType: fileType,
                    fileName: fileName,
                    fileSize: fileSize,
                    userId: currentUser.uid,
                    userName: userData.name,
                    userRole: userData.role,
                    userAvatar: userData.avatar,
                    isPremium: isPremiumUser,
                    likes: {},
                    comments: {},
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                db.ref('posts').push().set(postData)
                    .then(() => {
                        showNotification('ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        addEngagementPoints(5);
                        createPostModal.classList.remove('active');
                        document.getElementById('post-content-input').value = '';
                        document.getElementById('post-video-input').value = '';
                        document.getElementById('post-file-input').value = null;
                        document.getElementById('post-char-count').textContent = '0';
                        document.getElementById('post-upload-progress').style.display = 'none';
                        document.getElementById('submit-post-btn').disabled = false;
                    })
                    .catch((error) => {
                        showNotification('Ø®Ø·Ø£: ' + error.message, 'error');
                        document.getElementById('submit-post-btn').disabled = false;
                    });
            }

            document.getElementById('post-content-input').addEventListener('input', function() {
                const count = this.value.length;
                const counter = document.getElementById('post-char-count');
                counter.textContent = count;
                if (!isPremiumUser && count > 1000) counter.style.color = 'red';
                else counter.style.color = 'inherit';
            });

            function loadPosts() {
                const feed = document.getElementById('feed-container');
                db.ref('posts').orderByChild('timestamp').limitToLast(20).on('value', (snapshot) => {
                    feed.innerHTML = '';
                    const posts = snapshot.val();
                    if (!posts) return;
                    Object.keys(posts).reverse().forEach(postId => {
                        addPostToFeed(posts[postId], postId);
                    });
                });
            }

            function addPostToFeed(post, postId) {
                const feed = document.getElementById('feed-container');
                const postElement = document.createElement('div');
                postElement.className = 'post';
                
                let mediaHTML = '';
                if (post.fileUrl && post.fileType?.startsWith('image/')) {
                    mediaHTML = `<div class="post-media"><img src="${post.fileUrl}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±"></div>`;
                } else if (post.fileUrl && post.fileType?.startsWith('video/')) {
                    mediaHTML = `<div class="post-media"><video controls src="${post.fileUrl}"></video></div>`;
                } else if (post.videoUrl && post.videoUrl.includes('youtube.com/watch?v=')) {
                    const videoId = post.videoUrl.split('v=')[1].split('&')[0];
                    mediaHTML = `<div class="post-media"><iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe></div>`;
                } else if (post.fileUrl && post.fileType === 'application/pdf') {
                     mediaHTML = `<div class="post-image"><i class="fas fa-file-pdf" style="font-size:48px; color:#db4437;"></i></div>`;
                }
                
                let fileAttachmentHTML = '';
                 if (post.fileUrl && !post.fileType?.startsWith('image/') && !post.fileType?.startsWith('video/')) {
                    fileAttachmentHTML = `
                    <div class="file-attachment">
                        <i class="file-icon fas fa-file-pdf"></i>
                        <div class="file-info">
                            <div class="file-name">${post.fileName || 'Ù…Ù„Ù'}</div>
                            <div class="file-size">${post.fileSize ? (post.fileSize / 1024 / 1024).toFixed(2) + ' MB' : ''}</div>
                        </div>
                        <button class="download-btn" data-url="${post.fileUrl}" data-premium="${post.userRole === 'teacher'}">
                            ØªØ­Ù…ÙŠÙ„ ${post.userRole === 'teacher' ? '<i class="premium-lock fas fa-crown"></i>' : ''}
                        </button>
                    </div>`;
                }
                
                const likesCount = post.likes ? Object.keys(post.likes).length : 0;
                const isLiked = currentUser && post.likes && post.likes[currentUser.uid];

                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-user">
                            <img src="${post.userAvatar || 'https.i.pravatar.cc/35'}" alt="Ù…Ø³ØªØ®Ø¯Ù…" class="post-avatar">
                            <div class="post-user-info">
                                <div class="post-username">
                                    ${(post.userRole === 'teacher' || post.isPremium) ? '<span class="premium-badge">PRO</span>' : ''}
                                    ${post.userName}
                                </div>
                                <div class="post-user-type">${post.userRole === 'teacher' ? 'Ø£Ø³ØªØ§Ø°' : 'Ø·Ø§Ù„Ø¨'}</div>
                            </div>
                        </div>
                        <div class="post-more"><i class="fas fa-ellipsis-h"></i></div>
                    </div>
                    ${mediaHTML}
                    <div class="post-actions">
                        <div class="post-actions-left">
                            <i class="post-action fas fa-heart ${isLiked ? 'liked' : ''}" data-post="${postId}"></i>
                            <i class="post-action fas fa-comment"></i>
                            <i class="post-action fas fa-paper-plane"></i>
                        </div>
                        <div><i class="post-action fas fa-bookmark"></i></div>
                    </div>
                    <div class="post-likes">${likesCount} Ø¥Ø¹Ø¬Ø§Ø¨</div>
                    <div class="post-caption"><span class="username">${post.userName}</span> ${post.content || ''}</div>
                    ${fileAttachmentHTML}
                    <div class="content-warning">
                        <i class="fas fa-shield-alt"></i> Ù…Ø­ØªÙˆÙ‰ Ø¢Ù…Ù†.
                        <div class="report-btn" data-post="${postId}">Ø¥Ø¨Ù„Ø§Øº</div>
                    </div>
                    <div class="post-time">${formatTime(post.timestamp)}</div>
                `;
                feed.appendChild(postElement);
                
                const downloadBtn = postElement.querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', function() {
                        const fileUrl = this.dataset.url;
                        const isPremium = this.dataset.premium === 'true';
                        if (isPremium && !isPremiumUser) {
                            showNotification('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø®ØµØµ Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ† ÙÙ‚Ø·. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©!', 'warning');
                            return;
                        }
                        window.open(fileUrl, '_blank');
                    });
                }
            }

            // === 6. Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø§Ù„Ø¢Ù…Ù†) ===
            function addEngagementPoints(points) {
                if (!currentUser || !userData) return;
                const userRef = db.ref('users/' + currentUser.uid);
                userRef.child('engagementPoints').transaction((currentPoints) => {
                    return (currentPoints || 0) + points;
                });
            }

            function loadLeaderboard() {
                const leaderboardList = document.getElementById('leaderboard-list');
                db.ref('users').orderByChild('engagementPoints').limitToLast(10).on('value', (snapshot) => {
                    const users = snapshot.val();
                    if (!users) return;
                    const sortedUsers = Object.keys(users).map(uid => ({ uid, ...users[uid] }))
                        .sort((a, b) => (b.engagementPoints || 0) - (a.engagementPoints || 0));
                    
                    leaderboardList.innerHTML = '';
                    sortedUsers.forEach((user, index) => {
                        leaderboardList.innerHTML += `
                            <div class="leaderboard-item">
                                <div class="leaderboard-rank">${index + 1}</div>
                                <img src="${user.avatar || 'https://i.pravatar.cc/50'}" alt="Ù…Ø³ØªØ®Ø¯Ù…" class="result-avatar">
                                <div class="leaderboard-user">
                                    <div class="result-name">${user.name}</div>
                                    <div class="result-details">${user.role === 'teacher' ? 'Ø£Ø³ØªØ§Ø°' : 'Ø·Ø§Ù„Ø¨'}</div>
                                </div>
                                <div class="leaderboard-score">${user.engagementPoints || 0} Ù†Ù‚Ø·Ø© ØªÙØ§Ø¹Ù„</div>
                            </div>`;
                    });
                });
            }

            // === 7. Ø§Ù„Ø£Ø¯ÙˆØ§Øª (Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ Ù„ÙˆØ­Ø© Ø¨ÙŠØ¶Ø§Ø¡) ===
            
            // (Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© - Ø§Ù„Ø¢Ù…Ù†Ø©)
            const calcDisplay = document.getElementById('calc-display');
            let calcInput = '0';
            
            document.querySelectorAll('.calc-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const val = this.dataset.val;

                    try {
                        if (type === 'num' || val === '(' || val === ')') {
                            if (calcInput === '0') calcInput = val;
                            else calcInput += val;
                        } 
                        else if (type === 'decimal') {
                            if (!calcInput.includes(val)) calcInput += val;
                        }
                        else if (type === 'clear') {
                            calcInput = '0';
                        }
                        else if (type === 'op') {
                            if (calcInput === '0') return;
                            calcInput += ` ${val} `; // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ§Øª
                        }
                        else if (type === 'op-sci') {
                            calcInput = `${val}(${calcInput})`;
                        }
                        else if (type === 'equal') {
                            calcInput = evaluateScientific(calcInput);
                        }
                        calcDisplay.textContent = calcInput;
                    } catch (e) {
                        calcInput = 'Error';
                        calcDisplay.textContent = calcInput;
                    }
                });
            });

            function evaluateScientific(expression) {
                // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø±Ù…ÙˆØ² Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ Math
                let evalFriendlyExpression = expression
                    .replace(/âˆš/g, 'Math.sqrt')
                    .replace(/sin/g, 'Math.sin')
                    .replace(/cos/g, 'Math.cos')
                    .replace(/tan/g, 'Math.tan')
                    .replace(/log/g, 'Math.log10')
                    .replace(/ln/g, 'Math.log')
                    .replace(/\^/g, '**')
                    .replace(/!/g, 'factorial'); // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠ Ø¨Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ©
                
                // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠ (Factorial)
                function factorial(n) {
                    if (n < 0) return NaN;
                    if (n === 0) return 1;
                    let result = 1;
                    for (let i = 2; i <= n; i++) result *= i;
                    return result;
                }
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Function Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† eval() Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹
                // Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ²Ø§Ù„ ØºÙŠØ± Ø¢Ù…Ù† 100% ÙˆÙ„ÙƒÙ†Ù‡ Ø£ÙØ¶Ù„ Ù…Ù† eval Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                return new Function('factorial', `return ${evalFriendlyExpression}`)(factorial);
            }

            // (Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø§ØµÙ‚Ø© - Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)
            function loadStickyNotes() {
                if (!currentUser) return;
                const notesRef = db.ref('users/' + currentUser.uid + '/stickyNotes');
                notesRef.on('value', (snapshot) => {
                    const notes = snapshot.val();
                    const container = document.getElementById('sticky-notes-container');
                    container.innerHTML = '';
                    if (!notes) return;
                    Object.keys(notes).forEach(noteId => {
                        createStickyNoteElement(notes[noteId], noteId);
                    });
                });
            }
            function createStickyNoteElement(note, noteId) {
                const container = document.getElementById('sticky-notes-container');
                const noteElement = document.createElement('div');
                noteElement.className = 'sticky-note';
                noteElement.innerHTML = `
                    <div class="sticky-note-header">
                        <input type="text" class="sticky-note-title" placeholder="Ø¹Ù†ÙˆØ§Ù†..." value="${note.title || ''}">
                        <div class="sticky-note-actions">
                            <button class="sticky-note-action" data-action="delete">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <textarea class="sticky-note-content" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ...">${note.content || ''}</textarea>
                `;
                container.appendChild(noteElement);
                
                const titleInput = noteElement.querySelector('.sticky-note-title');
                const contentInput = noteElement.querySelector('.sticky-note-content');
                
                noteElement.querySelector('[data-action="delete"]').addEventListener('click', () => deleteStickyNote(noteId));
                titleInput.addEventListener('blur', () => saveStickyNote(noteId, titleInput.value, contentInput.value));
                contentInput.addEventListener('blur', () => saveStickyNote(noteId, titleInput.value, contentInput.value));
            }
            document.getElementById('add-sticky-note').addEventListener('click', () => {
                const newNoteRef = db.ref('users/' + currentUser.uid + '/stickyNotes').push();
                newNoteRef.set({
                    title: 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                    content: '',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
            });
            function saveStickyNote(noteId, title, content) {
                db.ref('users/' + currentUser.uid + '/stickyNotes/' + noteId).update({ title: title, content: content });
            }
            function deleteStickyNote(noteId) {
                db.ref('users/' + currentUser.uid + '/stickyNotes/' + noteId).remove();
            }
            
            // (Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡)
            let whiteboardCanvas, ctx, drawing = false, tool = 'pen', color = '#000000', width = 3;
            function initWhiteboard() {
                if (whiteboardCanvas) return;
                whiteboardCanvas = document.getElementById('whiteboard-canvas');
                ctx = whiteboardCanvas.getContext('2d');
                const container = whiteboardCanvas.parentElement;
                
                function resizeCanvas() {
                    whiteboardCanvas.width = container.clientWidth;
                    whiteboardCanvas.height = container.clientHeight;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.strokeStyle = color;
                    ctx.lineWidth = width;
                }
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);

                const events = {
                    start: ['mousedown', 'touchstart'],
                    stop: ['mouseup', 'touchend', 'mouseleave'],
                    draw: ['mousemove', 'touchmove']
                };
                
                events.start.forEach(e => whiteboardCanvas.addEventListener(e, startDrawing));
                events.stop.forEach(e => whiteboardCanvas.addEventListener(e, stopDrawing));
                events.draw.forEach(e => whiteboardCanvas.addEventListener(e, draw));
                
                document.querySelectorAll('.whiteboard-tool[data-tool]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelector('.whiteboard-tool.active').classList.remove('active');
                        btn.classList.add('active');
                        tool = btn.dataset.tool;
                    });
                });
                document.getElementById('whiteboard-color').addEventListener('input', (e) => color = e.target.value);
                document.getElementById('whiteboard-width').addEventListener('input', (e) => width = e.target.value);
                document.getElementById('clear-whiteboard').addEventListener('click', () => ctx.clearRect(0, 0, whiteboardCanvas.width, whiteboardCanvas.height));
            }
            function getCoords(e) {
                const rect = whiteboardCanvas.getBoundingClientRect();
                if (e.touches) return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
                return { x: e.clientX - rect.left, y: e.clientY - rect.top };
            }
            function startDrawing(e) {
                drawing = true;
                const { x, y } = getCoords(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            function stopDrawing() { drawing = false; ctx.beginPath(); }
            function draw(e) {
                if (!drawing) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                ctx.lineWidth = (tool === 'eraser') ? width * 5 : width;
                ctx.strokeStyle = (tool === 'eraser') ? '#FFFFFF' : color;
                ctx.globalCompositeOperation = (tool === 'eraser') ? 'destination-out' : 'source-over';
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            // === 8. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===
            
            document.getElementById('search-input').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const type = document.querySelector('.search-tab.active').dataset.type;
                searchUsers(query, type);
            });
            function searchUsers(query, type) {
                const resultsContainer = document.getElementById('search-results');
                if (query.length < 2) { resultsContainer.innerHTML = ''; return; }
                
                db.ref('users').orderByChild('name').startAt(query).endAt(query + '\uf8ff').once('value', (snapshot) => {
                    resultsContainer.innerHTML = '';
                    const users = snapshot.val();
                    if (!users) return;
                    Object.keys(users).forEach(uid => {
                        if (uid === currentUser.uid) return;
                        const user = users[uid];
                        if (type === 'all' || (type === 'teachers' && user.role === 'teacher')) {
                            addSearchResult(user, uid);
                        }
                    });
                });
            }
            function addSearchResult(user, uid) {
                const resultsContainer = document.getElementById('search-results');
                const amFollowing = userData?.following?.[uid];
                resultsContainer.innerHTML += `
                    <div class="search-result">
                        <img src="${user.avatar || 'https://i.pravatar.cc/50'}" alt="Ù…Ø³ØªØ®Ø¯Ù…" class="result-avatar">
                        <div class="result-info">
                            <div class="result-name">${user.name}</div>
                            <div class="result-details">${user.role === 'teacher' ? 'Ø£Ø³ØªØ§Ø°' : 'Ø·Ø§Ù„Ø¨'}</div>
                        </div>
                        <button class="follow-btn ${amFollowing ? 'following' : ''}" data-uid="${uid}">
                            ${amFollowing ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'Ù…ØªØ§Ø¨Ø¹Ø©'}
                        </button>
                    </div>`;
            }

            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('follow-btn')) {
                    followUser(e.target.dataset.uid, e.target);
                }
                if (e.target.classList.contains('fa-heart')) {
                    toggleLike(e.target.dataset.post, e.target);
                }
                if (e.target.classList.contains('report-btn')) {
                    reportContent(e.target.dataset.post);
                }
            });

            function followUser(targetUid, button) {
                if (!currentUser) return;
                const followingRef = db.ref(`users/${currentUser.uid}/following/${targetUid}`);
                const followerRef = db.ref(`users/${targetUid}/followers/${currentUser.uid}`);
                
                followingRef.once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        followingRef.remove();
                        followerRef.remove();
                        button.textContent = 'Ù…ØªØ§Ø¨Ø¹Ø©';
                        button.classList.remove('following');
                    } else {
                        followingRef.set(true);
                        followerRef.set(true);
                        button.textContent = 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
                        button.classList.add('following');
                    }
                });
            }

            function toggleLike(postId, heartIcon) {
                if (!currentUser) return;
                const likeRef = db.ref('posts/' + postId + '/likes/' + currentUser.uid);
                likeRef.once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        likeRef.remove();
                        heartIcon.classList.remove('liked');
                    } else {
                        likeRef.set(true);
                        heartIcon.classList.add('liked');
                        addEngagementPoints(1);
                    }
                });
            }

            function reportContent(postId) {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) {
                    db.ref('reports/' + postId).push({
                        reporter: currentUser.uid,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    showNotification('Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥Ø¨Ù„Ø§ØºÙƒ.', 'success');
                }
            }

            // === 9. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØªÙŠØ©) ===
            
            sendMessageBtn.addEventListener('click', () => {
                const message = chatMessageInput.value.trim();
                if (!message) return;
                if (!isContentSafe(message)) return showNotification('Ø±Ø³Ø§Ù„ØªÙƒ ØªØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ø©', 'error');
                
                sendChatMessage({ type: 'text', content: message });
                chatMessageInput.value = '';
            });

            function sendChatMessage(messageData) {
                const chatRef = db.ref('chats/' + activeChat + '/messages');
                chatRef.push({
                    sender: currentUser.uid,
                    senderName: userData.name,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    ...messageData
                });
                addEngagementPoints(2);
            }
            
            function loadMessages(chatId) {
                const messagesContainer = document.getElementById('chat-messages');
                db.ref('chats/' + chatId + '/messages').orderByChild('timestamp').limitToLast(50)
                  .on('value', (snapshot) => {
                    messagesContainer.innerHTML = '';
                    const messages = snapshot.val();
                    if (!messages) return;
                    Object.keys(messages).forEach(messageId => {
                        addMessageToChat(messages[messageId]);
                    });
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                  });
            }

            function addMessageToChat(message) {
                const messagesContainer = document.getElementById('chat-messages');
                const msgElement = document.createElement('div');
                const isSent = message.sender === currentUser.uid;
                msgElement.className = `message ${isSent ? 'sent' : 'received'}`;
                
                if (message.type === 'audio') {
                    msgElement.innerHTML = `
                        <div style="font-weight: 500; font-size: 12px; margin-bottom: 5px;">${isSent ? 'Ø£Ù†Øª' : message.senderName}</div>
                        <audio controls src="${message.audioUrl}"></audio>
                    `;
                } else {
                    msgElement.textContent = message.content;
                }
                messagesContainer.appendChild(msgElement);
            }
            
            recordAudioBtn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });

            async function startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                    mediaRecorder.start();
                    isRecording = true;
                    audioChunks = [];
                    
                    recordAudioBtn.classList.add('recording');
                    recordAudioBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    chatMessageInput.style.display = 'none';
                    sendMessageBtn.style.display = 'none';
                    recordingTimerDisplay.style.display = 'block';
                    
                    recordingStartTime = Date.now();
                    const maxDuration = (isPremiumUser ? 15 : 5) * 60 * 1000;
                    
                    recordingTimerInterval = setInterval(() => {
                        const elapsed = Date.now() - recordingStartTime;
                        if (elapsed >= maxDuration) {
                            showNotification(`ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (${isPremiumUser ? 15 : 5} Ø¯Ù‚ÙŠÙ‚Ø©). Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...`, 'warning');
                            stopRecording();
                        } else {
                            const minutes = Math.floor(elapsed / 60000);
                            const seconds = Math.floor((elapsed % 60000) / 1000);
                            recordingTimerDisplay.textContent = 
                                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        }
                    }, 1000);

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        uploadAudioMessage(audioBlob);
                        
                        stream.getTracks().forEach(track => track.stop());
                        audioChunks = [];
                        clearInterval(recordingTimerInterval);
                        
                        recordAudioBtn.classList.remove('recording');
                        recordAudioBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                        chatMessageInput.style.display = 'block';
                        sendMessageBtn.style.display = 'block';
                        recordingTimerDisplay.style.display = 'none';
                        recordingTimerDisplay.textContent = '00:00';
                    };
                    
                } catch (err) {
                    showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¥Ø°Ù†.', 'error');
                }
            }

            function stopRecording() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;
                }
            }
            
            function uploadAudioMessage(audioBlob) {
                showNotification('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ©...', 'success');
                const fileRef = storage.ref(`audioMessages/${currentUser.uid}/${Date.now()}.webm`);
                const uploadTask = fileRef.put(audioBlob);

                uploadTask.on('state_changed', null, 
                    (error) => showNotification('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØª: ' + error.message, 'error'),
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            sendChatMessage({
                                type: 'audio',
                                audioUrl: downloadURL
                            });
                        });
                    }
                );
            }

            // === 10. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ø¬Ø¯ÙŠØ¯) ===
            logoutBtn.addEventListener('click', () => {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                    auth.signOut();
                    profileModal.classList.remove('active');
                }
            });

            editProfileBtn.addEventListener('click', () => {
                document.getElementById('edit-name-input').value = userData.name;
                document.getElementById('edit-username-input').value = userData.username;
                document.getElementById('edit-bio-input').value = userData.bio || '';
                document.getElementById('edit-avatar-preview').src = userData.avatar || 'https://i.pravatar.cc/80';
                editProfileModal.classList.add('active');
            });
            
            document.getElementById('change-avatar-btn').addEventListener('click', () => {
                document.getElementById('edit-avatar-input').click();
            });
            
            document.getElementById('edit-avatar-input').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.getElementById('edit-avatar-preview').src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('save-profile-btn').addEventListener('click', function() {
                this.disabled = true;
                this.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                
                const name = document.getElementById('edit-name-input').value;
                const username = document.getElementById('edit-username-input').value;
                const bio = document.getElementById('edit-bio-input').value;
                const file = document.getElementById('edit-avatar-input').files[0];
                
                const updates = {
                    name: name,
                    username: username,
                    bio: bio,
                    profileComplete: true
                };

                if (file) {
                    const avatarRef = storage.ref(`avatars/${currentUser.uid}/${file.name}`);
                    avatarRef.put(file).then(snapshot => {
                        return snapshot.ref.getDownloadURL();
                    }).then(downloadURL => {
                        updates.avatar = downloadURL;
                        updateUserProfile(updates);
                    }).catch(err => {
                        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ' + err.message, 'error');
                        this.disabled = false;
                        this.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
                    });
                } else {
                    updateUserProfile(updates);
                }
            });
            
            function updateUserProfile(updates) {
                db.ref('users/' + currentUser.uid).update(updates)
                    .then(() => {
                        showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª!', 'success');
                        editProfileModal.classList.remove('active');
                        document.getElementById('save-profile-btn').disabled = false;
                        document.getElementById('save-profile-btn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
                    })
                    .catch(err => {
                        showNotification('Ø®Ø·Ø£: ' + err.message, 'error');
                        document.getElementById('save-profile-btn').disabled = false;
                        document.getElementById('save-profile-btn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
                    });
            }

            // === 11. Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„ØªÙ†Ù‚Ù„ ===
            function formatTime(timestamp) {
                if (!timestamp) return '...';
                const now = Date.now();
                const diff = now - timestamp;
                if (diff < 60000) return 'Ø§Ù„Ø¢Ù†';
                if (diff < 3600000) return `Ù…Ù†Ø° ${Math.floor(diff / 60000)} Ø¯Ù‚ÙŠÙ‚Ø©`;
                if (diff < 86400000) return `Ù…Ù†Ø° ${Math.floor(diff / 3600000)} Ø³Ø§Ø¹Ø©`;
                return `Ù…Ù†Ø° ${Math.floor(diff / 86400000)} ÙŠÙˆÙ…`;
            }
            function showNotification(message, type) { alert(message); }
            function isFriend(uid) { return userData?.following?.[uid]; }
            function isContentSafe(content) {
                if (!content) return true;
                const bannedWords = ['Ø¨Ø°ÙŠØ¡', 'ØªØ­Ø±Ø´', 'Ø¹Ù†Ù', 'ØªÙ‡Ø¯ÙŠØ¯'];
                return !bannedWords.some(word => content.toLowerCase().includes(word));
            }
            
            function showPage(targetPageId) {
                pages.forEach(page => page.style.display = 'none');
                const targetPage = document.getElementById(targetPageId);
                if (targetPage) targetPage.style.display = 'block';
                
                navItems.forEach(nav => {
                    nav.classList.toggle('active', nav.dataset.page === targetPageId);
                });

                if (targetPageId === 'chat-page') loadMessages(activeChat);
                if (targetPageId === 'leaderboard-page') loadLeaderboard();
            }

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPageId = this.getAttribute('data-page');
                    if (targetPageId) showPage(targetPageId);
                });
            });
            
            document.querySelectorAll('.search-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelector('.search-tab.active').classList.remove('active');
                    this.classList.add('active');
                    searchUsers(document.getElementById('search-input').value, this.dataset.type);
                });
            });
            
            // ÙØªØ­ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø£Ø¯ÙˆØ§Øª
            userProfileBtn.addEventListener('click', () => profileModal.classList.add('active'));
            createPostNavBtn.addEventListener('click', (e) => { e.preventDefault(); createPostModal.classList.add('active'); });
            calculatorBtn.addEventListener('click', () => calculatorModal.classList.add('active'));
            fahmiAiBtn.addEventListener('click', () => fahmiAiModal.classList.add('active'));
            stickyNotesBtn.addEventListener('click', () => { loadStickyNotes(); stickyNotesModal.classList.add('active'); });
            whiteboardBtn.addEventListener('click', () => { whiteboardModal.classList.add('active'); initWhiteboard(); });
            messagesBtn.addEventListener('click', () => showPage('chat-page'));
            upgradeBtn.addEventListener('click', () => upgradeModal.classList.add('active'));
            editProfileBtn.addEventListener('click', () => editProfileModal.classList.add('active'));
            
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById(this.dataset.modal).classList.remove('active');
                });
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            showPage('home-page');
        });
    </script>
</body>
</html>
